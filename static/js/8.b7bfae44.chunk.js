(self.webpackChunk_kne_components_react_pdf_sign=self.webpackChunk_kne_components_react_pdf_sign||[]).push([[8],{59169:e=>{function t(e){return Promise.resolve().then(()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=59169,e.exports=t},71830:(e,t,r)=>{"use strict";r.r(t),r.d(t,{LocationLayer:()=>C,PDFSign:()=>hr,PDFViewer:()=>z,default:()=>hr,useSignature:()=>_r});var n=r(51938),a=r(17402),i=r(2153),o=r(94922),s=r(74946),c=r(50805),u=r(54159),l=r.n(u),d=r(55199),f=r(57622),h=r(59790),p=(r(87821),r(70011),r(89261)),g=r(56075),v=r(48863),y=r(78678),_=r(81537),b=r.n(_),w=r(20274),j=r(90999),m=r(51766),x=r(80359);function O(){return O=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},O.apply(null,arguments)}function S(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}var A={"pdf-view-container":"_RgZXN","pdf-view":"_PAju1","pdf-view-children":"_N11Pj","pdf-view-page-control-left":"_IbVpf","pdf-view-page-control-right":"_IIgqj","pdf-view-page-control-current":"_JW3CT","signature-container":"_6TDb-","signature-canvas":"_2CGF4","signature-modal":"_kWe3k","signature-mask":"_FSvLv"};const P=["numPages"],z=e=>{let{className:t,defaultPage:r,apis:u,pdfjsUrl:g,url:v,maxWidth:y=1200,children:_}=e;var b;const{apis:w}=(0,s.usePreset)(),j=Object.assign({},w,u),m=g||(null==(b=j.file)?void 0:b.pdfjsUrl)||"https://cdn.jsdelivr.net/npm/pdfjs-dist@5.4.296";n.EA.workerSrc=m+"/build/pdf.worker.min.mjs";const x=(0,o.useMemo)(()=>({file:v,options:{standardFontDataUrl:m+"/standard_fonts/",cMapUrl:m+"/cmaps/",cMapPacked:!0}}),[m,v]),[z,k]=(0,o.useState)(y),[M,C]=(0,o.useState)(null),[E,N]=(0,o.useState)(0),[F,T]=(0,o.useState)(r||1),D=(0,c.A)(()=>{D.current&&D.current.clientWidth&&k(Math.min(D.current.clientWidth,y))});return(0,p.jsxs)("div",{ref:D,className:l()(t,A["pdf-view-container"],"pdf-view-container"),style:{maxWidth:y},children:[(0,p.jsx)("div",{className:l()(A["pdf-view"],"pdf-view"),children:(0,p.jsx)(a.A,O({},Object.assign({},x),{loading:(0,p.jsx)(d.Flex,{justify:"center",children:(0,p.jsx)(d.Spin,{})}),onLoadSuccess:e=>{let{numPages:t}=e;S(e,P),N(t),Number.isInteger(r)||T(t)},children:(0,p.jsx)(i.A,{width:z,pageNumber:F,renderTextLayer:!0,onLoadSuccess:e=>{C({width:Math.round(e.width),height:Math.round(e.height),originalWidth:e.originalWidth,originalHeight:e.originalHeight})}})}))}),M&&_&&(0,p.jsx)("div",{className:l()(A["pdf-view-children"],"pdf-view-children"),children:"function"===typeof _?_({size:M,currentPage:F,pageSize:E}):_}),(0,p.jsxs)("div",{className:l()(A["pdf-view-page-control"],"pdf-view-page-control"),children:[F>1&&(0,p.jsx)(f.A,{className:l()(A["pdf-view-page-control-left"],"pdf-view-page-control-left"),onClick:()=>{T(F-1)}}),F<E&&(0,p.jsx)(h.A,{className:l()(A["pdf-view-page-control-right"],"pdf-view-page-control-right"),onClick:()=>{T(F+1)}}),E?(0,p.jsxs)("div",{className:l()(A["pdf-view-page-control-current"],"pdf-view-page-control-current"),children:[F,"/",E]}):null]})]})},k=(0,w.createWithIntlProvider)({defaultLocale:"zh-CN",messages:{"zh-CN":{locationLayerPlaceholder:"\u7b7e\u540d\u533a\u57df",loadingError:"PDF\u5c1a\u672a\u52a0\u8f7d\u6210\u529f\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",signatureDefaultTitle:"\u7b7e\u540d",signatureConfirmText:"\u786e\u8ba4",signatureCancelText:"\u53d6\u6d88",signatureEmptyError:"\u7b7e\u540d\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a",signatureSuccess:"\u7b7e\u540d\u6210\u529f"},"en-US":{locationLayerPlaceholder:"Signature Area",loadingError:"PDF is not loaded successfully, please try again later",signatureDefaultTitle:"Signature",signatureConfirmText:"Confirm",signatureCancelText:"Cancel",signatureEmptyError:"Signature content cannot be empty",signatureSuccess:"Signature Success"}},namespace:"react-pdf-sign"}),M=["width","height","padding","stageWidth","stageHeight","placeholder","signature"],C=k(e=>{const{formatMessage:t}=(0,w.useIntl)(),{width:r=200,height:n=80,padding:a=8,stageWidth:i,stageHeight:s,placeholder:c=t({id:"locationLayerPlaceholder"}),signature:u}=e,l=S(e,M),[d,f]=(0,v.A)(l),[h,_]=(0,o.useState)(!1),[j]=b()(u),m=(0,o.useRef)(),x=(0,o.useRef)(),O=(0,o.useRef)(),A=()=>{const e=x.current.absolutePosition(),t=x.current.getClientRect();f({size:{width:Math.round(t.width),height:Math.round(t.height),x:Math.round(e.x),y:Math.round(e.y)},scaleX:Number(m.current.attrs.scaleX.toFixed(2)),scaleY:Number(m.current.attrs.scaleY.toFixed(2)),x:Math.round(m.current.attrs.x),y:Math.round(m.current.attrs.y)})},P=(0,y.A)(()=>{["scaleX","scaleY","x","y","size"].some(e=>!Object.assign({},d).hasOwnProperty(e))&&f({scaleX:1,scaleY:1,x:Math.round((i-r)/2),y:Math.round((s-n)/2),size:{width:r,height:n,x:Math.round((i-r)/2),y:Math.round((s-n)/2)}}),_(!0)}),z=(0,o.useMemo)(()=>{const e=document.createElement("div");e.style.color="var(--primary-color)",document.body.appendChild(e);const t=window.getComputedStyle(e).color;return document.body.removeChild(e),t},[]);return(0,o.useEffect)(()=>{P()},[]),(0,o.useEffect)(()=>{h&&O.current.nodes([m.current])},[h]),h&&d?(0,p.jsx)(g.BI,{width:i,height:s,children:(0,p.jsxs)(g.Wd,{children:[(0,p.jsxs)(g.YJ,{x:d.x,y:d.y,draggable:!0,ref:m,onDragEnd:A,scaleX:d.scaleX,scaleY:d.scaleY,onTransformEnd:A,children:[j?(0,p.jsx)(g._V,{width:r,height:n,image:j,cornerRadius:8,ref:x}):(0,p.jsx)(g.rw,{width:r,height:n,fill:"#f0f0f0",cornerRadius:8,ref:x}),(0,p.jsx)(g.EY,{text:j?"":c,fontSize:16,fill:"#666666",fontFamily:"Arial",align:"center",verticalAlign:"middle",width:r,height:n})]}),(0,p.jsx)(g.Ge,{ref:O,keepRatio:!0,flipEnabled:!1,rotateEnabled:!1,borderStroke:z,rotateAnchorStroke:z,anchorStroke:z,padding:a})]})}):null});var E=function(){this.__data__=[],this.size=0};var N=function(e,t){return e===t||e!==e&&t!==t};var F=function(e,t){for(var r=e.length;r--;)if(N(e[r][0],t))return r;return-1},T=Array.prototype.splice;var D=function(e){var t=this.__data__,r=F(t,e);return!(r<0)&&(r==t.length-1?t.pop():T.call(t,r,1),--this.size,!0)};var L=function(e){var t=this.__data__,r=F(t,e);return r<0?void 0:t[r][1]};var I=function(e){return F(this.__data__,e)>-1};var W=function(e,t){var r=this.__data__,n=F(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function R(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}R.prototype.clear=E,R.prototype.delete=D,R.prototype.get=L,R.prototype.has=I,R.prototype.set=W;var U=R;var B=function(){this.__data__=new U,this.size=0};var H=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var Y=function(e){return this.__data__.get(e)};var V=function(e){return this.__data__.has(e)},X="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof r.g?r.g:"undefined"!==typeof self?self:{};function $(e){var t={exports:{}};return e(t,t.exports),t.exports}var q="object"==typeof X&&X&&X.Object===Object&&X,G="object"==typeof self&&self&&self.Object===Object&&self,J=q||G||Function("return this")(),Z=J.Symbol,K=Object.prototype,Q=K.hasOwnProperty,ee=K.toString,te=Z?Z.toStringTag:void 0;var re=function(e){var t=Q.call(e,te),r=e[te];try{e[te]=void 0;var n=!0}catch(i){}var a=ee.call(e);return n&&(t?e[te]=r:delete e[te]),a},ne=Object.prototype.toString;var ae=function(e){return ne.call(e)},ie=Z?Z.toStringTag:void 0;var oe=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":ie&&ie in Object(e)?re(e):ae(e)};var se=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var ce=function(e){if(!se(e))return!1;var t=oe(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},ue=J["__core-js_shared__"],le=function(){var e=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var de=function(e){return!!le&&le in e},fe=Function.prototype.toString;var he=function(e){if(null!=e){try{return fe.call(e)}catch(t){}try{return e+""}catch(t){}}return""},pe=/^\[object .+?Constructor\]$/,ge=Function.prototype,ve=Object.prototype,ye=ge.toString,_e=ve.hasOwnProperty,be=RegExp("^"+ye.call(_e).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var we=function(e){return!(!se(e)||de(e))&&(ce(e)?be:pe).test(he(e))};var je=function(e,t){return null==e?void 0:e[t]};var me=function(e,t){var r=je(e,t);return we(r)?r:void 0},xe=me(J,"Map"),Oe=me(Object,"create");var Se=function(){this.__data__=Oe?Oe(null):{},this.size=0};var Ae=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Pe=Object.prototype.hasOwnProperty;var ze=function(e){var t=this.__data__;if(Oe){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Pe.call(t,e)?t[e]:void 0},ke=Object.prototype.hasOwnProperty;var Me=function(e){var t=this.__data__;return Oe?void 0!==t[e]:ke.call(t,e)};var Ce=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Oe&&void 0===t?"__lodash_hash_undefined__":t,this};function Ee(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ee.prototype.clear=Se,Ee.prototype.delete=Ae,Ee.prototype.get=ze,Ee.prototype.has=Me,Ee.prototype.set=Ce;var Ne=Ee;var Fe=function(){this.size=0,this.__data__={hash:new Ne,map:new(xe||U),string:new Ne}};var Te=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var De=function(e,t){var r=e.__data__;return Te(t)?r["string"==typeof t?"string":"hash"]:r.map};var Le=function(e){var t=De(this,e).delete(e);return this.size-=t?1:0,t};var Ie=function(e){return De(this,e).get(e)};var We=function(e){return De(this,e).has(e)};var Re=function(e,t){var r=De(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Ue(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ue.prototype.clear=Fe,Ue.prototype.delete=Le,Ue.prototype.get=Ie,Ue.prototype.has=We,Ue.prototype.set=Re;var Be=Ue;var He=function(e,t){var r=this.__data__;if(r instanceof U){var n=r.__data__;if(!xe||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Be(n)}return r.set(e,t),this.size=r.size,this};function Ye(e){var t=this.__data__=new U(e);this.size=t.size}Ye.prototype.clear=B,Ye.prototype.delete=H,Ye.prototype.get=Y,Ye.prototype.has=V,Ye.prototype.set=He;var Ve=Ye;var Xe=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var $e=function(e){return this.__data__.has(e)};function qe(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Be;++t<r;)this.add(e[t])}qe.prototype.add=qe.prototype.push=Xe,qe.prototype.has=$e;var Ge=qe;var Je=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var Ze=function(e,t){return e.has(t)};var Ke=function(e,t,r,n,a,i){var o=1&r,s=e.length,c=t.length;if(s!=c&&!(o&&c>s))return!1;var u=i.get(e),l=i.get(t);if(u&&l)return u==t&&l==e;var d=-1,f=!0,h=2&r?new Ge:void 0;for(i.set(e,t),i.set(t,e);++d<s;){var p=e[d],g=t[d];if(n)var v=o?n(g,p,d,t,e,i):n(p,g,d,e,t,i);if(void 0!==v){if(v)continue;f=!1;break}if(h){if(!Je(t,function(e,t){if(!Ze(h,t)&&(p===e||a(p,e,r,n,i)))return h.push(t)})){f=!1;break}}else if(p!==g&&!a(p,g,r,n,i)){f=!1;break}}return i.delete(e),i.delete(t),f},Qe=J.Uint8Array;var et=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r};var tt=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r},rt=Z?Z.prototype:void 0,nt=rt?rt.valueOf:void 0;var at=function(e,t,r,n,a,i,o){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!i(new Qe(e),new Qe(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return N(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=et;case"[object Set]":var c=1&n;if(s||(s=tt),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;n|=2,o.set(e,t);var l=Ke(s(e),s(t),n,a,i,o);return o.delete(e),l;case"[object Symbol]":if(nt)return nt.call(e)==nt.call(t)}return!1};var it=function(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e},ot=Array.isArray;var st=function(e,t,r){var n=t(e);return ot(e)?n:it(n,r(e))};var ct=function(e,t){for(var r=-1,n=null==e?0:e.length,a=0,i=[];++r<n;){var o=e[r];t(o,r,e)&&(i[a++]=o)}return i};var ut=function(){return[]},lt=Object.prototype.propertyIsEnumerable,dt=Object.getOwnPropertySymbols,ft=dt?function(e){return null==e?[]:(e=Object(e),ct(dt(e),function(t){return lt.call(e,t)}))}:ut;var ht=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var pt=function(e){return null!=e&&"object"==typeof e};var gt=function(e){return pt(e)&&"[object Arguments]"==oe(e)},vt=Object.prototype,yt=vt.hasOwnProperty,_t=vt.propertyIsEnumerable,bt=gt(function(){return arguments}())?gt:function(e){return pt(e)&&yt.call(e,"callee")&&!_t.call(e,"callee")};var wt=function(){return!1},jt=$(function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r?J.Buffer:void 0,i=(a?a.isBuffer:void 0)||wt;e.exports=i}),mt=/^(?:0|[1-9]\d*)$/;var xt=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&mt.test(e))&&e>-1&&e%1==0&&e<t};var Ot=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},St={};St["[object Float32Array]"]=St["[object Float64Array]"]=St["[object Int8Array]"]=St["[object Int16Array]"]=St["[object Int32Array]"]=St["[object Uint8Array]"]=St["[object Uint8ClampedArray]"]=St["[object Uint16Array]"]=St["[object Uint32Array]"]=!0,St["[object Arguments]"]=St["[object Array]"]=St["[object ArrayBuffer]"]=St["[object Boolean]"]=St["[object DataView]"]=St["[object Date]"]=St["[object Error]"]=St["[object Function]"]=St["[object Map]"]=St["[object Number]"]=St["[object Object]"]=St["[object RegExp]"]=St["[object Set]"]=St["[object String]"]=St["[object WeakMap]"]=!1;var At=function(e){return pt(e)&&Ot(e.length)&&!!St[oe(e)]};var Pt=function(e){return function(t){return e(t)}},zt=$(function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r&&q.process,i=function(){try{var e=n&&n.require&&n.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(t){}}();e.exports=i}),kt=zt&&zt.isTypedArray,Mt=kt?Pt(kt):At,Ct=Object.prototype.hasOwnProperty;var Et=function(e,t){var r=ot(e),n=!r&&bt(e),a=!r&&!n&&jt(e),i=!r&&!n&&!a&&Mt(e),o=r||n||a||i,s=o?ht(e.length,String):[],c=s.length;for(var u in e)!t&&!Ct.call(e,u)||o&&("length"==u||a&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||xt(u,c))||s.push(u);return s},Nt=Object.prototype;var Ft=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Nt)};var Tt=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),Dt=Object.prototype.hasOwnProperty;var Lt=function(e){if(!Ft(e))return Tt(e);var t=[];for(var r in Object(e))Dt.call(e,r)&&"constructor"!=r&&t.push(r);return t};var It=function(e){return null!=e&&Ot(e.length)&&!ce(e)};var Wt=function(e){return It(e)?Et(e):Lt(e)};var Rt=function(e){return st(e,Wt,ft)},Ut=Object.prototype.hasOwnProperty;var Bt=function(e,t,r,n,a,i){var o=1&r,s=Rt(e),c=s.length;if(c!=Rt(t).length&&!o)return!1;for(var u=c;u--;){var l=s[u];if(!(o?l in t:Ut.call(t,l)))return!1}var d=i.get(e),f=i.get(t);if(d&&f)return d==t&&f==e;var h=!0;i.set(e,t),i.set(t,e);for(var p=o;++u<c;){var g=e[l=s[u]],v=t[l];if(n)var y=o?n(v,g,l,t,e,i):n(g,v,l,e,t,i);if(!(void 0===y?g===v||a(g,v,r,n,i):y)){h=!1;break}p||(p="constructor"==l)}if(h&&!p){var _=e.constructor,b=t.constructor;_==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof b&&b instanceof b||(h=!1)}return i.delete(e),i.delete(t),h},Ht=me(J,"DataView"),Yt=me(J,"Promise"),Vt=me(J,"Set"),Xt=me(J,"WeakMap"),$t="[object Map]",qt="[object Promise]",Gt="[object Set]",Jt="[object WeakMap]",Zt="[object DataView]",Kt=he(Ht),Qt=he(xe),er=he(Yt),tr=he(Vt),rr=he(Xt),nr=oe;(Ht&&nr(new Ht(new ArrayBuffer(1)))!=Zt||xe&&nr(new xe)!=$t||Yt&&nr(Yt.resolve())!=qt||Vt&&nr(new Vt)!=Gt||Xt&&nr(new Xt)!=Jt)&&(nr=function(e){var t=oe(e),r="[object Object]"==t?e.constructor:void 0,n=r?he(r):"";if(n)switch(n){case Kt:return Zt;case Qt:return $t;case er:return qt;case tr:return Gt;case rr:return Jt}return t});var ar=nr,ir="[object Arguments]",or="[object Array]",sr="[object Object]",cr=Object.prototype.hasOwnProperty;var ur=function(e,t,r,n,a,i){var o=ot(e),s=ot(t),c=o?or:ar(e),u=s?or:ar(t),l=(c=c==ir?sr:c)==sr,d=(u=u==ir?sr:u)==sr,f=c==u;if(f&&jt(e)){if(!jt(t))return!1;o=!0,l=!1}if(f&&!l)return i||(i=new Ve),o||Mt(e)?Ke(e,t,r,n,a,i):at(e,t,c,r,n,a,i);if(!(1&r)){var h=l&&cr.call(e,"__wrapped__"),p=d&&cr.call(t,"__wrapped__");if(h||p){var g=h?e.value():e,v=p?t.value():t;return i||(i=new Ve),a(g,v,r,n,i)}}return!!f&&(i||(i=new Ve),Bt(e,t,r,n,a,i))};var lr=function e(t,r,n,a,i){return t===r||(null==t||null==r||!pt(t)&&!pt(r)?t!==t&&r!==r:ur(t,r,n,a,e,i))};var dr=function(e,t){return lr(e,t)};const fr=["placeholder","signature","url","width","height","padding","filename","defaultLocation","onChange"],hr=k((0,o.forwardRef)((e,t)=>{let{placeholder:r,signature:n,url:a,width:i,height:s,padding:c,filename:u="signed-document.pdf",defaultLocation:l,onChange:d}=e,f=S(e,fr);const[h,g]=(0,o.useState)(Object.assign({},l)),[v,_]=(0,o.useState)(null),{formatMessage:b}=(0,w.useIntl)(),m=(0,o.useMemo)(()=>{if(!v)return null;const{size:e,currentPage:t}=v,r=e.width/e.originalWidth,i=e.height/e.originalHeight,o=Math.round(h.size.x/r),s=Math.round(e.originalHeight-h.size.y/i),c=Math.round(h.size.width/r),l=Math.round(h.size.height/i);return{x:o,y:s-l,page:t,pageWidth:Math.round(e.originalWidth),pageHeight:Math.round(e.originalHeight),width:c,height:l,signature:n,url:a,filename:u}},[v,h,n,a,u]),x=(0,o.useCallback)(async()=>{if(!v)throw new Error(b({id:"loadingError"}));return await(async e=>{const{x:t,y:r,page:n,width:a,height:i,signature:o,url:s,filename:c}=e,u=await window.fetch(s),l=await u.arrayBuffer(),d=await j.PDFDocument.load(l),f=d.getPage(n-1),h=await window.fetch(o).then(e=>e.arrayBuffer()),p=await d.embedPng(h);f.drawImage(p,{x:t,y:r,width:a,height:i});const g=await d.save();return new window.File([g],c,{type:"application/pdf"})})(m)},[m]);(0,o.useImperativeHandle)(t,()=>({getLocation:()=>h,setLocation:e=>g(e),getPdfSignature:()=>m,sign:()=>x()}));const A=(0,y.A)(d);return(0,o.useEffect)(()=>{null==A||A({pdfSignature:m,location:h})},[m,h,A]),(0,p.jsx)(z,O({},f,{url:a,children:e=>{let{size:t,currentPage:a}=e;return setTimeout(()=>{dr({size:t,currentPage:a},v)||_({size:t,currentPage:a})},0),(0,p.jsx)(C,{stageWidth:t.width,stageHeight:t.height,width:i,height:s,padding:c,placeholder:r,signature:n,value:h,onChange:g})}}))})),pr=["filename","onSuccess","width","height","mask"],gr=e=>{let t=e.split(","),r=t[1].substring(0,t[1].length-2),n=t[0].match(/:(.*?);/)[1],a=atob(r),i=a.length,o=new Uint8Array(i);for(;i--;)o[i]=a.charCodeAt(i);return new Blob([o],{type:n})},vr=k(e=>{let{onClose:t,onSuccess:r,filename:n,width:a,height:i,mask:s=null}=e;const{formatMessage:c}=(0,w.useIntl)(),{message:u}=d.App.useApp(),f=(0,o.useRef)(null),h=(0,o.useRef)(null);return(0,p.jsxs)(d.Flex,{vertical:!0,gap:12,className:l()(A["signature-modal-content"],"signature-modal-content"),children:[(0,p.jsxs)("div",{className:l()(A["signature-container"],"signature-container"),style:{width:"368px",height:"".concat(Math.round(368*i/a),"px")},children:[(0,p.jsx)("div",{className:l()(A["signature-mask"],"signature-mask"),ref:h,children:s}),(0,p.jsx)(m.A,{ref:f,canvasProps:{className:l()(A["signature-canvas"],"signature-canvas")}})]}),(0,p.jsxs)(d.Flex,{justify:"flex-end",align:"center",gap:10,children:[(0,p.jsx)(d.Button,{onClick:()=>{t()},children:c({id:"signatureCancelText"})}),(0,p.jsx)(d.Button,{type:"primary",onClick:async()=>{if(f.current.isEmpty())return void u.error(c({id:"signatureEmptyError"}));let e=f.current.toDataURL("image/png");if(s){const t=await x.ph.toPng(h.current,{scale:2}),r=document.createElement("canvas");r.width=2*a,r.height=2*i;const n=r.getContext("2d");n.drawImage(t,0,0,r.width,r.height);const o=new Image;o.src=e,await new Promise(e=>{o.onload=e}),n.drawImage(o,0,0,r.width,r.height),e=r.toDataURL("image/png")}const o=new window.File([gr(e)],n,{type:"image/png"});t(),r(o)},children:c({id:"signatureConfirmText"})})]})]})}),yr=k(()=>{const{formatMessage:e}=(0,w.useIntl)();return(0,p.jsx)("span",{children:e({id:"signatureDefaultTitle"})})}),_r=()=>{const{modal:e}=d.App.useApp();return t=>{const r=Object.assign({},t),{filename:n="signature.png",onSuccess:a,width:i=200,height:o=80,mask:s}=r,c=S(r,pr),u=e.info(Object.assign({},{title:(0,p.jsx)(yr,{}),icon:null,footer:null,wrapClassName:A["signature-modal"],classNames:{content:A["signature-modal"]}},c,{content:(0,p.jsx)(vr,{width:i,height:o,mask:s,filename:n,onSuccess:a,onClose:()=>{u.destroy()}})}));return u}}}}]);
//# sourceMappingURL=8.b7bfae44.chunk.js.map