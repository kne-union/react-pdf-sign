(self.webpackChunk_kne_components_react_pdf_sign=self.webpackChunk_kne_components_react_pdf_sign||[]).push([[8],{59169:e=>{function t(e){return Promise.resolve().then(()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=59169,e.exports=t},71830:(e,t,n)=>{"use strict";n.r(t),n.d(t,{LocationLayer:()=>E,PDFSign:()=>Ne,PDFViewer:()=>k,default:()=>Ne,signPdfFile:()=>_e,useSignature:()=>We});var r=n(51938),a=n(17402),i=n(2153),o=n(94922),s=n(74946),c=n(50805),l=n(54159),u=n.n(l),d=n(55199),g=n(57622),h=n(59790),f=(n(87821),n(70011),n(89261)),p=n(56075),w=n(48863),m=n(78678),v=n(81537),y=n.n(v),j=n(20274),x=n(90999),b=n(51766),S=n(80359);function P(){return P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},P.apply(null,arguments)}function C(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}var M={"pdf-view-container":"_RgZXN","pdf-view":"_PAju1","pdf-view-children":"_N11Pj","pdf-view-page-control-left":"_IbVpf","pdf-view-page-control-right":"_IIgqj","pdf-view-page-control-current":"_JW3CT","signature-container":"_6TDb-","signature-canvas":"_2CGF4","signature-modal":"_kWe3k","signature-mask":"_FSvLv"};const O=["numPages"],k=e=>{let{className:t,defaultPage:n,apis:l,pdfjsUrl:p,url:w,maxWidth:m=1200,children:v}=e;var y;const{apis:j}=(0,s.usePreset)(),x=Object.assign({},j,l),b=p||(null==(y=x.file)?void 0:y.pdfjsUrl)||"https://cdn.jsdelivr.net/npm/pdfjs-dist@5.4.296";r.EA.workerSrc=b+"/build/pdf.worker.min.mjs";const S=(0,o.useMemo)(()=>({file:w,options:{standardFontDataUrl:b+"/standard_fonts/",cMapUrl:b+"/cmaps/",cMapPacked:!0}}),[b,w]),[k,_]=(0,o.useState)(m),[A,E]=(0,o.useState)(null),[N,T]=(0,o.useState)(0),[F,L]=(0,o.useState)(n||1),D=(0,c.A)(()=>{D.current&&D.current.clientWidth&&_(Math.min(D.current.clientWidth,m))});return(0,f.jsxs)("div",{ref:D,className:u()(t,M["pdf-view-container"],"pdf-view-container"),style:{maxWidth:m},children:[(0,f.jsx)("div",{className:u()(M["pdf-view"],"pdf-view"),children:(0,f.jsx)(a.A,P({},Object.assign({},S),{loading:(0,f.jsx)(d.Flex,{justify:"center",children:(0,f.jsx)(d.Spin,{})}),onLoadSuccess:e=>{let{numPages:t}=e;C(e,O),T(t),Number.isInteger(n)||L(t)},children:(0,f.jsx)(i.A,{width:k,pageNumber:F,renderTextLayer:!0,onLoadSuccess:e=>{E({width:Math.round(e.width),height:Math.round(e.height),originalWidth:e.originalWidth,originalHeight:e.originalHeight})}})}))}),A&&v&&(0,f.jsx)("div",{className:u()(M["pdf-view-children"],"pdf-view-children"),children:"function"===typeof v?v({size:A,currentPage:F,pageSize:N}):v}),(0,f.jsxs)("div",{className:u()(M["pdf-view-page-control"],"pdf-view-page-control"),children:[F>1&&(0,f.jsx)(g.A,{className:u()(M["pdf-view-page-control-left"],"pdf-view-page-control-left"),onClick:()=>{L(F-1)}}),F<N&&(0,f.jsx)(h.A,{className:u()(M["pdf-view-page-control-right"],"pdf-view-page-control-right"),onClick:()=>{L(F+1)}}),N?(0,f.jsxs)("div",{className:u()(M["pdf-view-page-control-current"],"pdf-view-page-control-current"),children:[F,"/",N]}):null]})]})},_=(0,j.createWithIntlProvider)({defaultLocale:"zh-CN",messages:{"zh-CN":{locationLayerPlaceholder:"\u7b7e\u540d\u533a\u57df",loadingError:"PDF\u5c1a\u672a\u52a0\u8f7d\u6210\u529f\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",signatureDefaultTitle:"\u7b7e\u540d",signatureConfirmText:"\u786e\u8ba4",signatureCancelText:"\u53d6\u6d88",signatureCleanText:"\u6e05\u7a7a",signatureEmptyError:"\u7b7e\u540d\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a",signatureSuccess:"\u7b7e\u540d\u6210\u529f"},"en-US":{locationLayerPlaceholder:"Signature Area",loadingError:"PDF is not loaded successfully, please try again later",signatureDefaultTitle:"Signature",signatureConfirmText:"Confirm",signatureCancelText:"Cancel",signatureCleanText:"Clean",signatureEmptyError:"Signature content cannot be empty",signatureSuccess:"Signature Success"}},namespace:"react-pdf-sign"}),A=["width","height","padding","stageWidth","stageHeight","placeholder","signature"],E=_(e=>{const{formatMessage:t}=(0,j.useIntl)(),{width:n=200,height:r=80,padding:a=8,stageWidth:i,stageHeight:s,placeholder:c=t({id:"locationLayerPlaceholder"}),signature:l}=e,u=C(e,A),[d,g]=(0,w.A)(u),[h,v]=(0,o.useState)(!1),[x]=y()(l),b=(0,o.useRef)(),S=(0,o.useRef)(),P=(0,o.useRef)(),M=()=>{const e=S.current.absolutePosition(),t=S.current.getClientRect();g({size:{width:Math.round(t.width),height:Math.round(t.height),x:Math.round(e.x),y:Math.round(e.y)},scaleX:Number(b.current.attrs.scaleX.toFixed(2)),scaleY:Number(b.current.attrs.scaleY.toFixed(2)),x:Math.round(b.current.attrs.x),y:Math.round(b.current.attrs.y)})},O=(0,m.A)(()=>{["scaleX","scaleY","x","y","size"].some(e=>!Object.assign({},d).hasOwnProperty(e))&&g({scaleX:1,scaleY:1,x:Math.round((i-n)/2),y:Math.round((s-r)/2),size:{width:n,height:r,x:Math.round((i-n)/2),y:Math.round((s-r)/2)}}),v(!0)}),k=(0,o.useMemo)(()=>{const e=document.createElement("div");e.style.color="var(--primary-color)",document.body.appendChild(e);const t=window.getComputedStyle(e).color;return document.body.removeChild(e),t},[]);return(0,o.useEffect)(()=>{O()},[]),(0,o.useEffect)(()=>{h&&P.current.nodes([b.current])},[h]),h&&d?(0,f.jsx)(p.BI,{width:i,height:s,children:(0,f.jsxs)(p.Wd,{children:[(0,f.jsxs)(p.YJ,{x:d.x,y:d.y,draggable:!0,ref:b,onDragEnd:M,scaleX:d.scaleX,scaleY:d.scaleY,onTransformEnd:M,children:[x?(0,f.jsx)(p._V,{width:n,height:r,image:x,cornerRadius:8,ref:S}):(0,f.jsx)(p.rw,{width:n,height:r,fill:"#f0f0f0",cornerRadius:8,ref:S}),(0,f.jsx)(p.EY,{text:x?"":c,fontSize:16,fill:"#666666",fontFamily:"Arial",align:"center",verticalAlign:"middle",width:n,height:r})]}),(0,f.jsx)(p.Ge,{ref:P,keepRatio:!0,flipEnabled:!1,rotateEnabled:!1,borderStroke:k,rotateAnchorStroke:k,anchorStroke:k,padding:a})]})}):null});var N="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{};function T(e){var t={exports:{}};return e(t,t.exports),t.exports}var F="object"==typeof N&&N&&N.Object===Object&&N,L="object"==typeof self&&self&&self.Object===Object&&self,D=F||L||Function("return this")(),W=D.Symbol,z=Object.prototype,I=z.hasOwnProperty,R=z.toString,U=W?W.toStringTag:void 0;var H=function(e){var t=I.call(e,U),n=e[U];try{e[U]=void 0;var r=!0}catch(i){}var a=R.call(e);return r&&(t?e[U]=n:delete e[U]),a},B=Object.prototype.toString;var Y=function(e){return B.call(e)},X=W?W.toStringTag:void 0;var $=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":X&&X in Object(e)?H(e):Y(e)};var V=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var q=function(e){if(!V(e))return!1;var t=$(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},G=D["__core-js_shared__"],J=function(){var e=/[^.]+$/.exec(G&&G.keys&&G.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var Z=function(e){return!!J&&J in e},K=Function.prototype.toString;var Q=function(e){if(null!=e){try{return K.call(e)}catch(t){}try{return e+""}catch(t){}}return""},ee=/^\[object .+?Constructor\]$/,te=Function.prototype,ne=Object.prototype,re=te.toString,ae=ne.hasOwnProperty,ie=RegExp("^"+re.call(ae).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var oe=function(e){return!(!V(e)||Z(e))&&(q(e)?ie:ee).test(Q(e))};var se=function(e,t){return null==e?void 0:e[t]};var ce=function(e,t){var n=se(e,t);return oe(n)?n:void 0},le=ce(D,"Map");ce(Object,"create");var ue=function(e){return null!=e&&"object"==typeof e};var de=function(e){return ue(e)&&"[object Arguments]"==$(e)},ge=Object.prototype;ge.hasOwnProperty,ge.propertyIsEnumerable;de(function(){return arguments}());var he=function(){return!1};T(function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,a=r&&r.exports===n?D.Buffer:void 0,i=(a?a.isBuffer:void 0)||he;e.exports=i}),T(function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,a=r&&r.exports===n&&F.process,i=function(){try{var e=r&&r.require&&r.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(t){}}();e.exports=i});var fe=ce(D,"DataView"),pe=ce(D,"Promise"),we=ce(D,"Set"),me=ce(D,"WeakMap"),ve="[object Map]",ye="[object Promise]",je="[object Set]",xe="[object WeakMap]",be="[object DataView]",Se=Q(fe),Pe=Q(le),Ce=Q(pe),Me=Q(we),Oe=Q(me),ke=$;(fe&&ke(new fe(new ArrayBuffer(1)))!=be||le&&ke(new le)!=ve||pe&&ke(pe.resolve())!=ye||we&&ke(new we)!=je||me&&ke(new me)!=xe)&&(ke=function(e){var t=$(e),n="[object Object]"==t?e.constructor:void 0,r=n?Q(n):"";if(r)switch(r){case Se:return be;case Pe:return ve;case Ce:return ye;case Me:return je;case Oe:return xe}return t});const _e=async e=>{const{x:t,y:n,page:r,width:a,height:i,signature:o,url:s,filename:c}=e,l=await window.fetch(s),u=await l.arrayBuffer(),d=await x.PDFDocument.load(u),g=d.getPage(r-1),h=await window.fetch(o).then(e=>e.arrayBuffer()),f=await d.embedPng(h);g.drawImage(f,{x:t,y:n,width:a,height:i});const p=await d.save();return new window.File([p],c,{type:"application/pdf"})},Ae=["placeholder","signature","url","width","height","padding","filename","defaultLocation","onChange"],Ee=(0,o.forwardRef)((e,t)=>{let{size:n,currentPage:r,placeholder:a,signature:i,url:s,width:c=200,height:l=80,padding:u,filename:d="signed-document.pdf",defaultLocation:g,onChange:h}=e;const p=(0,o.useMemo)(()=>({scaleX:1,scaleY:1,x:Math.round((n.width-c)/2),y:Math.round((n.height-l)/2),size:{width:c,height:l,x:Math.round((n.width-c)/2),y:Math.round((n.height-l)/2)}}),[n,c,l]),[w,v]=(0,o.useState)(Object.assign({},p,g)),y=(0,m.A)(e=>{v(Object.assign({},p,e))}),j=(0,o.useMemo)(()=>{const e=n.width/n.originalWidth,t=n.height/n.originalHeight,a=Math.round(w.size.x/e),o=Math.round(n.originalHeight-w.size.y/t),c=Math.round(w.size.width/e),l=Math.round(w.size.height/t);return{x:a,y:o-l,page:r,pageWidth:Math.round(n.originalWidth),pageHeight:Math.round(n.originalHeight),width:c,height:l,signature:i,url:s,filename:d}},[w,i,s,d,n,r]),x=(0,o.useCallback)(async()=>await _e(j),[j]);(0,o.useImperativeHandle)(t,()=>({getLocation:()=>w,setLocation:e=>y(e),getPdfSignature:()=>j,sign:()=>x()}));const b=(0,m.A)(h);return(0,o.useEffect)(()=>{null==b||b({pdfSignature:j,location:w})},[j,w,b]),(0,f.jsx)(E,{stageWidth:n.width,stageHeight:n.height,width:c,height:l,padding:u,placeholder:a,signature:i,value:w,onChange:y})}),Ne=_((0,o.forwardRef)((e,t)=>{let{placeholder:n,signature:r,url:a,width:i,height:o,padding:s,filename:c="signed-document.pdf",defaultLocation:l,onChange:u}=e,d=C(e,Ae);return(0,f.jsx)(k,P({},d,{url:a,children:e=>{let{size:d,currentPage:g}=e;return(0,f.jsx)(Ee,{ref:t,size:d,currentPage:g,url:a,filename:c,defaultLocation:l,width:i,height:o,padding:s,placeholder:n,signature:r,onChange:u})}}))})),Te=["filename","onSuccess","width","height","mask"],Fe=e=>{let t=e.split(","),n=t[1].substring(0,t[1].length-2),r=t[0].match(/:(.*?);/)[1],a=atob(n),i=a.length,o=new Uint8Array(i);for(;i--;)o[i]=a.charCodeAt(i);return new Blob([o],{type:r})},Le=_(e=>{let{onClose:t,onSuccess:n,filename:r,width:a,height:i,mask:s=null}=e;const{formatMessage:c}=(0,j.useIntl)(),{message:l}=d.App.useApp(),g=(0,o.useRef)(null),h=(0,o.useRef)(null),[p,w]=(0,o.useState)(!1);return(0,f.jsxs)(d.Flex,{vertical:!0,gap:12,className:u()(M["signature-modal-content"],"signature-modal-content"),children:[(0,f.jsxs)("div",{className:u()(M["signature-container"],"signature-container"),style:{width:"100%",height:"".concat(Math.round(368*i/a),"px")},children:[(0,f.jsx)("div",{className:u()(M["signature-mask"],"signature-mask"),ref:h,children:s}),(0,f.jsx)(b.A,{ref:g,canvasProps:{className:u()(M["signature-canvas"],"signature-canvas")}})]}),(0,f.jsxs)(d.Flex,{justify:"flex-end",align:"center",gap:10,children:[(0,f.jsx)(d.Button,{onClick:()=>{g.current.clear()},children:c({id:"signatureCleanText"})}),(0,f.jsx)(d.Button,{loading:p,type:"primary",onClick:async()=>{w(!0);try{if(g.current.isEmpty())return void l.error(c({id:"signatureEmptyError"}));let e=g.current.toDataURL("image/png");if(s){const t=await S.ph.toPng(h.current,{scale:2}),n=document.createElement("canvas");n.width=2*a,n.height=2*i;const r=n.getContext("2d");r.drawImage(t,0,0,n.width,n.height);const o=new Image;o.src=e,await new Promise(e=>{o.onload=e}),r.drawImage(o,0,0,n.width,n.height),e=n.toDataURL("image/png")}const o=new window.File([Fe(e)],r,{type:"image/png"}),u=n&&await n(o);if(w(!1),!1===u)return;t()}catch(e){l.error(e.message),w(!1)}},children:c({id:"signatureConfirmText"})})]})]})}),De=_(()=>{const{formatMessage:e}=(0,j.useIntl)();return(0,f.jsx)("span",{children:e({id:"signatureDefaultTitle"})})}),We=()=>{const{modal:e}=d.App.useApp();return t=>{const n=Object.assign({},t),{filename:r="signature.png",onSuccess:a,width:i=200,height:o=80,mask:s}=n,c=C(n,Te),l=e.info(Object.assign({},{title:(0,f.jsx)(De,{}),icon:null,footer:null,closable:!0,wrapClassName:M["signature-modal"],classNames:{content:M["signature-modal"]}},c,{content:(0,f.jsx)(Le,{width:i,height:o,mask:s,filename:r,onSuccess:a,onClose:()=>{l.destroy()}})}));return l}}}}]);
//# sourceMappingURL=8.c959d20a.chunk.js.map