(self.webpackChunk_kne_components_react_pdf_sign=self.webpackChunk_kne_components_react_pdf_sign||[]).push([[8],{59169:e=>{function t(e){return Promise.resolve().then(()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=59169,e.exports=t},71830:(e,t,r)=>{"use strict";r.r(t),r.d(t,{LocationLayer:()=>E,PDFSign:()=>hr,PDFViewer:()=>P,default:()=>hr,useSignature:()=>yr});var n=r(51938),a=r(17402),i=r(2153),o=r(94922),s=r(74946),c=r(50805),u=r(54159),l=r.n(u),f=r(55199),h=r(57622),d=r(59790),p=(r(87821),r(70011),r(89261)),g=r(56075),v=r(48863),y=r(78678),_=r(81537),b=r.n(_),j=r(20274),w=r(90999),m=r(51766);function x(){return x=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},x.apply(null,arguments)}function O(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}var S={"pdf-view-container":"_RgZXN","pdf-view":"_PAju1","pdf-view-children":"_N11Pj","pdf-view-page-control-left":"_IbVpf","pdf-view-page-control-right":"_IIgqj","pdf-view-page-control-current":"_JW3CT","signature-container":"_6TDb-","signature-canvas":"_2CGF4","signature-modal":"_kWe3k"};const A=["numPages"],P=e=>{let{className:t,defaultPage:r,apis:u,pdfjsUrl:g,url:v,maxWidth:y=1200,children:_}=e;var b;const{apis:j}=(0,s.usePreset)(),w=Object.assign({},j,u),m=g||(null==(b=w.file)?void 0:b.pdfjsUrl)||"https://cdn.jsdelivr.net/npm/pdfjs-dist@5.4.296";n.EA.workerSrc=m+"/build/pdf.worker.min.mjs";const P=(0,o.useMemo)(()=>({file:v,options:{standardFontDataUrl:m+"/standard_fonts/",cMapUrl:m+"/cmaps/",cMapPacked:!0}}),[m,v]),[z,M]=(0,o.useState)(y),[E,k]=(0,o.useState)(null),[C,N]=(0,o.useState)(0),[F,T]=(0,o.useState)(r||1),D=(0,c.A)(()=>{D.current&&D.current.clientWidth&&M(Math.min(D.current.clientWidth,y))});return(0,p.jsxs)("div",{ref:D,className:l()(t,S["pdf-view-container"],"pdf-view-container"),style:{maxWidth:y},children:[(0,p.jsx)("div",{className:l()(S["pdf-view"],"pdf-view"),children:(0,p.jsx)(a.A,x({},Object.assign({},P),{loading:(0,p.jsx)(f.Flex,{justify:"center",children:(0,p.jsx)(f.Spin,{})}),onLoadSuccess:e=>{let{numPages:t}=e;O(e,A),N(t),Number.isInteger(r)||T(t)},children:(0,p.jsx)(i.A,{width:z,pageNumber:F,renderTextLayer:!0,onLoadSuccess:e=>{k({width:Math.round(e.width),height:Math.round(e.height),originalWidth:e.originalWidth,originalHeight:e.originalHeight})}})}))}),E&&_&&(0,p.jsx)("div",{className:l()(S["pdf-view-children"],"pdf-view-children"),children:"function"===typeof _?_({size:E,currentPage:F,pageSize:C}):_}),(0,p.jsxs)("div",{className:l()(S["pdf-view-page-control"],"pdf-view-page-control"),children:[F>1&&(0,p.jsx)(h.A,{className:l()(S["pdf-view-page-control-left"],"pdf-view-page-control-left"),onClick:()=>{T(F-1)}}),F<C&&(0,p.jsx)(d.A,{className:l()(S["pdf-view-page-control-right"],"pdf-view-page-control-right"),onClick:()=>{T(F+1)}}),C?(0,p.jsxs)("div",{className:l()(S["pdf-view-page-control-current"],"pdf-view-page-control-current"),children:[F,"/",C]}):null]})]})},z=(0,j.createWithIntlProvider)({defaultLocale:"zh-CN",messages:{"zh-CN":{locationLayerPlaceholder:"\u7b7e\u540d\u533a\u57df",loadingError:"PDF\u5c1a\u672a\u52a0\u8f7d\u6210\u529f\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",signatureDefaultTitle:"\u7b7e\u540d",signatureConfirmText:"\u786e\u8ba4",signatureCancelText:"\u53d6\u6d88",signatureEmptyError:"\u7b7e\u540d\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a",signatureSuccess:"\u7b7e\u540d\u6210\u529f"},"en-US":{locationLayerPlaceholder:"Signature Area",loadingError:"PDF is not loaded successfully, please try again later",signatureDefaultTitle:"Signature",signatureConfirmText:"Confirm",signatureCancelText:"Cancel",signatureEmptyError:"Signature content cannot be empty",signatureSuccess:"Signature Success"}},namespace:"react-pdf-sign"}),M=["width","height","padding","stageWidth","stageHeight","placeholder","signature"],E=z(e=>{const{formatMessage:t}=(0,j.useIntl)(),{width:r=200,height:n=50,padding:a=8,stageWidth:i,stageHeight:s,placeholder:c=t({id:"locationLayerPlaceholder"}),signature:u}=e,l=O(e,M),[f,h]=(0,v.A)(l),[d,_]=(0,o.useState)(!1),[w]=b()(u),m=(0,o.useRef)(),x=(0,o.useRef)(),S=(0,o.useRef)(),A=()=>{const e=x.current.absolutePosition(),t=x.current.getClientRect();h({size:{width:Math.round(t.width),height:Math.round(t.height),x:Math.round(e.x),y:Math.round(e.y)},scaleX:Number(S.current.attrs.scaleX.toFixed(2)),scaleY:Number(S.current.attrs.scaleY.toFixed(2)),x:Math.round(m.current.attrs.x),y:Math.round(m.current.attrs.y)})},P=(0,y.A)(()=>{["scaleX","scaleY","x","y","size"].some(e=>!Object.assign({},f).hasOwnProperty(e))&&(h({scaleX:1,scaleY:1,x:Math.round((i-r)/2),y:Math.round((s-n)/2),size:{width:r,height:n,x:Math.round((i-r)/2),y:Math.round((s-n)/2)}}),_(!0))}),z=(0,o.useMemo)(()=>{const e=document.createElement("div");e.style.color="var(--primary-color)",document.body.appendChild(e);const t=window.getComputedStyle(e).color;return document.body.removeChild(e),t},[]);return(0,o.useEffect)(()=>{P()},[]),(0,o.useEffect)(()=>{d&&S.current.nodes([m.current])},[d]),d&&f?(0,p.jsx)(g.BI,{width:i,height:s,children:(0,p.jsxs)(g.Wd,{children:[(0,p.jsxs)(g.YJ,{x:f.x,y:f.y,draggable:!0,ref:m,onDragEnd:A,onTransformEnd:A,children:[w?(0,p.jsx)(g._V,{width:r,height:n,image:w,cornerRadius:8,ref:x}):(0,p.jsx)(g.rw,{width:r,height:n,fill:"#f0f0f0",cornerRadius:8,ref:x}),(0,p.jsx)(g.EY,{text:w?"":c,fontSize:16,fill:"#666666",fontFamily:"Arial",align:"center",verticalAlign:"middle",width:r,height:n})]}),(0,p.jsx)(g.Ge,{scaleX:f.scaleX,scaleY:f.scaleY,centeredScaling:!0,ref:S,keepRatio:!0,flipEnabled:!1,rotateEnabled:!1,borderStroke:z,rotateAnchorStroke:z,anchorStroke:z,padding:a,enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]})}):null});var k=function(){this.__data__=[],this.size=0};var C=function(e,t){return e===t||e!==e&&t!==t};var N=function(e,t){for(var r=e.length;r--;)if(C(e[r][0],t))return r;return-1},F=Array.prototype.splice;var T=function(e){var t=this.__data__,r=N(t,e);return!(r<0)&&(r==t.length-1?t.pop():F.call(t,r,1),--this.size,!0)};var D=function(e){var t=this.__data__,r=N(t,e);return r<0?void 0:t[r][1]};var W=function(e){return N(this.__data__,e)>-1};var I=function(e,t){var r=this.__data__,n=N(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function L(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}L.prototype.clear=k,L.prototype.delete=T,L.prototype.get=D,L.prototype.has=W,L.prototype.set=I;var R=L;var U=function(){this.__data__=new R,this.size=0};var B=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var H=function(e){return this.__data__.get(e)};var Y=function(e){return this.__data__.has(e)},V="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof r.g?r.g:"undefined"!==typeof self?self:{};function X(e){var t={exports:{}};return e(t,t.exports),t.exports}var $="object"==typeof V&&V&&V.Object===Object&&V,q="object"==typeof self&&self&&self.Object===Object&&self,G=$||q||Function("return this")(),J=G.Symbol,Z=Object.prototype,K=Z.hasOwnProperty,Q=Z.toString,ee=J?J.toStringTag:void 0;var te=function(e){var t=K.call(e,ee),r=e[ee];try{e[ee]=void 0;var n=!0}catch(i){}var a=Q.call(e);return n&&(t?e[ee]=r:delete e[ee]),a},re=Object.prototype.toString;var ne=function(e){return re.call(e)},ae=J?J.toStringTag:void 0;var ie=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":ae&&ae in Object(e)?te(e):ne(e)};var oe=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var se=function(e){if(!oe(e))return!1;var t=ie(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},ce=G["__core-js_shared__"],ue=function(){var e=/[^.]+$/.exec(ce&&ce.keys&&ce.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var le=function(e){return!!ue&&ue in e},fe=Function.prototype.toString;var he=function(e){if(null!=e){try{return fe.call(e)}catch(t){}try{return e+""}catch(t){}}return""},de=/^\[object .+?Constructor\]$/,pe=Function.prototype,ge=Object.prototype,ve=pe.toString,ye=ge.hasOwnProperty,_e=RegExp("^"+ve.call(ye).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var be=function(e){return!(!oe(e)||le(e))&&(se(e)?_e:de).test(he(e))};var je=function(e,t){return null==e?void 0:e[t]};var we=function(e,t){var r=je(e,t);return be(r)?r:void 0},me=we(G,"Map"),xe=we(Object,"create");var Oe=function(){this.__data__=xe?xe(null):{},this.size=0};var Se=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ae=Object.prototype.hasOwnProperty;var Pe=function(e){var t=this.__data__;if(xe){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Ae.call(t,e)?t[e]:void 0},ze=Object.prototype.hasOwnProperty;var Me=function(e){var t=this.__data__;return xe?void 0!==t[e]:ze.call(t,e)};var Ee=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=xe&&void 0===t?"__lodash_hash_undefined__":t,this};function ke(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ke.prototype.clear=Oe,ke.prototype.delete=Se,ke.prototype.get=Pe,ke.prototype.has=Me,ke.prototype.set=Ee;var Ce=ke;var Ne=function(){this.size=0,this.__data__={hash:new Ce,map:new(me||R),string:new Ce}};var Fe=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Te=function(e,t){var r=e.__data__;return Fe(t)?r["string"==typeof t?"string":"hash"]:r.map};var De=function(e){var t=Te(this,e).delete(e);return this.size-=t?1:0,t};var We=function(e){return Te(this,e).get(e)};var Ie=function(e){return Te(this,e).has(e)};var Le=function(e,t){var r=Te(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Re(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Re.prototype.clear=Ne,Re.prototype.delete=De,Re.prototype.get=We,Re.prototype.has=Ie,Re.prototype.set=Le;var Ue=Re;var Be=function(e,t){var r=this.__data__;if(r instanceof R){var n=r.__data__;if(!me||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ue(n)}return r.set(e,t),this.size=r.size,this};function He(e){var t=this.__data__=new R(e);this.size=t.size}He.prototype.clear=U,He.prototype.delete=B,He.prototype.get=H,He.prototype.has=Y,He.prototype.set=Be;var Ye=He;var Ve=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var Xe=function(e){return this.__data__.has(e)};function $e(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Ue;++t<r;)this.add(e[t])}$e.prototype.add=$e.prototype.push=Ve,$e.prototype.has=Xe;var qe=$e;var Ge=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var Je=function(e,t){return e.has(t)};var Ze=function(e,t,r,n,a,i){var o=1&r,s=e.length,c=t.length;if(s!=c&&!(o&&c>s))return!1;var u=i.get(e),l=i.get(t);if(u&&l)return u==t&&l==e;var f=-1,h=!0,d=2&r?new qe:void 0;for(i.set(e,t),i.set(t,e);++f<s;){var p=e[f],g=t[f];if(n)var v=o?n(g,p,f,t,e,i):n(p,g,f,e,t,i);if(void 0!==v){if(v)continue;h=!1;break}if(d){if(!Ge(t,function(e,t){if(!Je(d,t)&&(p===e||a(p,e,r,n,i)))return d.push(t)})){h=!1;break}}else if(p!==g&&!a(p,g,r,n,i)){h=!1;break}}return i.delete(e),i.delete(t),h},Ke=G.Uint8Array;var Qe=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r};var et=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r},tt=J?J.prototype:void 0,rt=tt?tt.valueOf:void 0;var nt=function(e,t,r,n,a,i,o){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!i(new Ke(e),new Ke(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return C(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=Qe;case"[object Set]":var c=1&n;if(s||(s=et),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;n|=2,o.set(e,t);var l=Ze(s(e),s(t),n,a,i,o);return o.delete(e),l;case"[object Symbol]":if(rt)return rt.call(e)==rt.call(t)}return!1};var at=function(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e},it=Array.isArray;var ot=function(e,t,r){var n=t(e);return it(e)?n:at(n,r(e))};var st=function(e,t){for(var r=-1,n=null==e?0:e.length,a=0,i=[];++r<n;){var o=e[r];t(o,r,e)&&(i[a++]=o)}return i};var ct=function(){return[]},ut=Object.prototype.propertyIsEnumerable,lt=Object.getOwnPropertySymbols,ft=lt?function(e){return null==e?[]:(e=Object(e),st(lt(e),function(t){return ut.call(e,t)}))}:ct;var ht=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var dt=function(e){return null!=e&&"object"==typeof e};var pt=function(e){return dt(e)&&"[object Arguments]"==ie(e)},gt=Object.prototype,vt=gt.hasOwnProperty,yt=gt.propertyIsEnumerable,_t=pt(function(){return arguments}())?pt:function(e){return dt(e)&&vt.call(e,"callee")&&!yt.call(e,"callee")};var bt=function(){return!1},jt=X(function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r?G.Buffer:void 0,i=(a?a.isBuffer:void 0)||bt;e.exports=i}),wt=/^(?:0|[1-9]\d*)$/;var mt=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&wt.test(e))&&e>-1&&e%1==0&&e<t};var xt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Ot={};Ot["[object Float32Array]"]=Ot["[object Float64Array]"]=Ot["[object Int8Array]"]=Ot["[object Int16Array]"]=Ot["[object Int32Array]"]=Ot["[object Uint8Array]"]=Ot["[object Uint8ClampedArray]"]=Ot["[object Uint16Array]"]=Ot["[object Uint32Array]"]=!0,Ot["[object Arguments]"]=Ot["[object Array]"]=Ot["[object ArrayBuffer]"]=Ot["[object Boolean]"]=Ot["[object DataView]"]=Ot["[object Date]"]=Ot["[object Error]"]=Ot["[object Function]"]=Ot["[object Map]"]=Ot["[object Number]"]=Ot["[object Object]"]=Ot["[object RegExp]"]=Ot["[object Set]"]=Ot["[object String]"]=Ot["[object WeakMap]"]=!1;var St=function(e){return dt(e)&&xt(e.length)&&!!Ot[ie(e)]};var At=function(e){return function(t){return e(t)}},Pt=X(function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r&&$.process,i=function(){try{var e=n&&n.require&&n.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(t){}}();e.exports=i}),zt=Pt&&Pt.isTypedArray,Mt=zt?At(zt):St,Et=Object.prototype.hasOwnProperty;var kt=function(e,t){var r=it(e),n=!r&&_t(e),a=!r&&!n&&jt(e),i=!r&&!n&&!a&&Mt(e),o=r||n||a||i,s=o?ht(e.length,String):[],c=s.length;for(var u in e)!t&&!Et.call(e,u)||o&&("length"==u||a&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||mt(u,c))||s.push(u);return s},Ct=Object.prototype;var Nt=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ct)};var Ft=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),Tt=Object.prototype.hasOwnProperty;var Dt=function(e){if(!Nt(e))return Ft(e);var t=[];for(var r in Object(e))Tt.call(e,r)&&"constructor"!=r&&t.push(r);return t};var Wt=function(e){return null!=e&&xt(e.length)&&!se(e)};var It=function(e){return Wt(e)?kt(e):Dt(e)};var Lt=function(e){return ot(e,It,ft)},Rt=Object.prototype.hasOwnProperty;var Ut=function(e,t,r,n,a,i){var o=1&r,s=Lt(e),c=s.length;if(c!=Lt(t).length&&!o)return!1;for(var u=c;u--;){var l=s[u];if(!(o?l in t:Rt.call(t,l)))return!1}var f=i.get(e),h=i.get(t);if(f&&h)return f==t&&h==e;var d=!0;i.set(e,t),i.set(t,e);for(var p=o;++u<c;){var g=e[l=s[u]],v=t[l];if(n)var y=o?n(v,g,l,t,e,i):n(g,v,l,e,t,i);if(!(void 0===y?g===v||a(g,v,r,n,i):y)){d=!1;break}p||(p="constructor"==l)}if(d&&!p){var _=e.constructor,b=t.constructor;_==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof b&&b instanceof b||(d=!1)}return i.delete(e),i.delete(t),d},Bt=we(G,"DataView"),Ht=we(G,"Promise"),Yt=we(G,"Set"),Vt=we(G,"WeakMap"),Xt="[object Map]",$t="[object Promise]",qt="[object Set]",Gt="[object WeakMap]",Jt="[object DataView]",Zt=he(Bt),Kt=he(me),Qt=he(Ht),er=he(Yt),tr=he(Vt),rr=ie;(Bt&&rr(new Bt(new ArrayBuffer(1)))!=Jt||me&&rr(new me)!=Xt||Ht&&rr(Ht.resolve())!=$t||Yt&&rr(new Yt)!=qt||Vt&&rr(new Vt)!=Gt)&&(rr=function(e){var t=ie(e),r="[object Object]"==t?e.constructor:void 0,n=r?he(r):"";if(n)switch(n){case Zt:return Jt;case Kt:return Xt;case Qt:return $t;case er:return qt;case tr:return Gt}return t});var nr=rr,ar="[object Arguments]",ir="[object Array]",or="[object Object]",sr=Object.prototype.hasOwnProperty;var cr=function(e,t,r,n,a,i){var o=it(e),s=it(t),c=o?ir:nr(e),u=s?ir:nr(t),l=(c=c==ar?or:c)==or,f=(u=u==ar?or:u)==or,h=c==u;if(h&&jt(e)){if(!jt(t))return!1;o=!0,l=!1}if(h&&!l)return i||(i=new Ye),o||Mt(e)?Ze(e,t,r,n,a,i):nt(e,t,c,r,n,a,i);if(!(1&r)){var d=l&&sr.call(e,"__wrapped__"),p=f&&sr.call(t,"__wrapped__");if(d||p){var g=d?e.value():e,v=p?t.value():t;return i||(i=new Ye),a(g,v,r,n,i)}}return!!h&&(i||(i=new Ye),Ut(e,t,r,n,a,i))};var ur=function e(t,r,n,a,i){return t===r||(null==t||null==r||!dt(t)&&!dt(r)?t!==t&&r!==r:cr(t,r,n,a,e,i))};var lr=function(e,t){return ur(e,t)};const fr=["placeholder","signature","url","width","height","padding","filename"],hr=z((0,o.forwardRef)((e,t)=>{let{placeholder:r,signature:n,url:a,width:i,height:s,padding:c,filename:u="signed-document.pdf"}=e,l=O(e,fr);const[f,h]=(0,o.useState)({}),[d,g]=(0,o.useState)(null),{formatMessage:v}=(0,j.useIntl)(),y=(0,o.useMemo)(()=>{if(!d)return null;const{size:e,currentPage:t}=d,r=e.width/e.originalWidth,i=e.height/e.originalHeight;return{x:Math.round(f.size.x/r),y:Math.round(e.originalHeight-f.size.y/i)-f.size.height,page:t,pageWidth:e.originalWidth,pageHeight:e.originalHeight,width:f.size.width,height:f.size.height,signature:n,url:a}},[d,f,n,a]),_=(0,o.useCallback)(async()=>{if(!d)throw new Error(v({id:"loadingError"}));const{x:e,y:t,page:r,width:n,height:a,signature:i,url:o}=y,s=await window.fetch(o),c=await s.arrayBuffer(),l=await w.PDFDocument.load(c),f=l.getPage(r-1),h=await window.fetch(i).then(e=>e.arrayBuffer()),p=await l.embedPng(h);f.drawImage(p,{x:e,y:t,width:n,height:a});const g=await l.save();return new window.File([g],u,{type:"application/pdf"})},[y]);return(0,o.useImperativeHandle)(t,()=>({getLocation:()=>f,setLocation:e=>h(e),getPdfSignature:()=>y,sign:()=>_()})),(0,p.jsx)(P,x({},l,{url:a,children:e=>{let{size:t,currentPage:a}=e;return setTimeout(()=>{lr({size:t,currentPage:a},d)||g({size:t,currentPage:a})},0),(0,p.jsx)(E,{stageWidth:t.width,stageHeight:t.height,width:i,height:s,padding:c,placeholder:r,signature:n,value:f,onChange:h})}}))})),dr=["filename","onSuccess"],pr=e=>{let t=e.split(","),r=t[1].substring(0,t[1].length-2),n=t[0].match(/:(.*?);/)[1],a=atob(r),i=a.length,o=new Uint8Array(i);for(;i--;)o[i]=a.charCodeAt(i);return new Blob([o],{type:n})},gr=z(e=>{let{onClose:t,onSuccess:r,filename:n,width:a,height:i}=e;const{formatMessage:s}=(0,j.useIntl)(),{message:c}=f.App.useApp(),u=(0,o.useRef)(null);return(0,p.jsxs)(f.Flex,{vertical:!0,gap:12,className:l()(S["signature-modal-content"],"signature-modal-content"),children:[(0,p.jsx)("div",{className:l()(S["signature-container"],"signature-container"),style:{width:"368px",height:"".concat(Math.round(368*i/a),"px")},children:(0,p.jsx)(m.A,{ref:u,canvasProps:{className:l()(S["signature-canvas"],"signature-canvas")}})}),(0,p.jsxs)(f.Flex,{justify:"flex-end",align:"center",gap:10,children:[(0,p.jsx)(f.Button,{onClick:()=>{t()},children:s({id:"signatureCancelText"})}),(0,p.jsx)(f.Button,{type:"primary",onClick:()=>{if(u.current.isEmpty())return void c.error(s({id:"signatureEmptyError"}));const e=new window.File([pr(u.current.toDataURL("image/png"))],n,{type:"image/png"});t(),r(e)},children:s({id:"signatureConfirmText"})})]})]})}),vr=z(()=>{const{formatMessage:e}=(0,j.useIntl)();return(0,p.jsx)("span",{children:e({id:"signatureDefaultTitle"})})}),yr=e=>{const{width:t,height:r}=Object.assign({},{width:200,height:50},e),{modal:n,message:a}=f.App.useApp();return(0,o.useRef)(null),e=>{const a=Object.assign({},e),{filename:i="signature.png",onSuccess:o}=a,s=O(a,dr),c=n.info(Object.assign({},{title:(0,p.jsx)(vr,{}),icon:null,footer:null,wrapClassName:S["signature-modal"],classNames:{content:S["signature-modal"]}},s,{content:(0,p.jsx)(gr,{width:t,height:r,filename:i,onSuccess:o,onClose:()=>{c.destroy()}})}));return c}}}}]);
//# sourceMappingURL=8.df68e0a8.chunk.js.map